generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id        String     @id @default(uuid())
  nome      String
  email     String     @unique
  senha     String
  papel     String
  mfaSecret String?
  criadoEm  DateTime   @default(now())
  Consulta  Consulta[]

  @@index([email])
}

model Utente {
  id             String           @id @default(uuid())
  nome           String
  dataNascimento DateTime?
  sexo           String?
  contacto       String?          @unique
  localizacao    String?
  idLocal        String?
  senha          String?
  consultas      Consulta[]
  leituras       LeituraClinica[]
  notificacoes   Notificacao[]
  triagens       Triagem[]
  zona           Zona?            @relation(fields: [idLocal], references: [id])
}

model Consulta {
  id             String      @id @default(uuid())
  utenteId       String
  profissionalId String?
  tipo           String
  data           DateTime
  resumo         String?
  prescricaoId   String?     @unique
  realizada      Boolean     @default(false)
  Usuario        Usuario?    @relation(fields: [profissionalId], references: [id])
  utente         Utente      @relation(fields: [utenteId], references: [id], onDelete: Cascade)
  prescricao     Prescricao?
}

model LeituraClinica {
  id          String   @id @default(uuid())
  utenteId    String
  tipo        String
  valor       Float
  dataHora    DateTime @default(now())
  inseridoPor String?
  utente      Utente   @relation(fields: [utenteId], references: [id], onDelete: Cascade)
}

model Prescricao {
  id          String   @id @default(uuid())
  consultaId  String   @unique
  medicamento String
  dosagem     String
  duracao     String?
  observacoes String?
  dataCriacao DateTime @default(now())
  consulta    Consulta @relation(fields: [consultaId], references: [id], onDelete: Cascade)
}

model Triagem {
  id            String   @id @default(uuid())
  utenteId      String
  respostasJson String
  resultado     String
  recomendacao  String?
  data          DateTime @default(now())
  utente        Utente   @relation(fields: [utenteId], references: [id], onDelete: Cascade)
}

model Notificacao {
  id        String   @id @default(uuid())
  utenteId  String
  tipo      String
  mensagem  String
  enviadoEm DateTime @default(now())
  status    String?
  utente    Utente   @relation(fields: [utenteId], references: [id], onDelete: Cascade)
}

model Auditoria {
  id         String   @id @default(uuid())
  entidade   String
  entidadeId String
  acao       String
  userId     String?
  timestamp  DateTime @default(now())
  detalhe    String?
}

model Zona {
  id          String   @id @default(uuid())
  nome        String
  coordenadas String?
  utentes     Utente[]
}
